<!DOCTYPE html>
<html>

<head>
    <style>
        /* 스타일을 추가하여 달력을 꾸미세요 */
        .calendar-container {
            display: flex;
            align-items: flex-start;
        }

        /* 달력 스타일 */
        #calendar {
            width: 60%;
            margin-right: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f5f5f5;
            box-sizing: border-box;

        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            /* 테이블의 열 너비를 고정 */
        }


        .calendar-table th,
        .calendar-table td {
            text-align: center;
            padding: 10px;
            border: 1px solid #ccc;
        }

        .calendar-table th {
            background-color: #eee;
        }

        .calendar-table td {
            text-align: center;
            padding: 10px;
            border: 1px solid #ccc;
            overflow: hidden;
            /* 셀 내용이 넘칠 경우 숨김 처리 */
            white-space: nowrap;
            /* 내용을 한 줄로 처리 */
            cursor: pointer;
        }


        .other-month {
            color: #aaa;
        }

        .selected {
            background-color: #3498db;
            color: white;
        }

        /* 이벤트 영역 스타일 */
        #event-display {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #fff;
            box-sizing: border-box;
        }

        #selected-date {
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* 이벤트 영역 스타일 */
        #event-display {
            width: 35%;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #fff;
        }

        .event-details {
            margin-top: 10px;
        }

        .event-item {
            margin-bottom: 10px;
            padding: 5px;
            border: 1px solid #ccc;
            background-color: #f5f5f5;
        }

        /* 이전/다음 버튼 스타일 */
        #prev,
        #next {
            margin-top: 10px;
            padding: 5px 10px;
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
        }

        /* 이전/다음 버튼 호버 스타일 */
        #prev:hover,
        #next:hover {
            background-color: #2980b9;
        }
    </style>
</head>

<body>
    <div class="calendar-container">
        <div id="calendar"></div>
        <div id="event-display">
            <h2>Event Details</h2>
            <div id="event-details"></div>
        </div>
    </div>
    <button id="prev">Previous</button>
    <button id="next">Next</button>

    <!-- <form method="POST" action="/add_cal">
        <label for="user_id">User ID:</label>
        <input type="text" id="user_id" name="user_id" required><br><br>

        <label for="date">Date:</label>
        <input type="date" id="date" name="date" required><br><br>

        <label for="time">Time:</label>
        <input type="number" id="time" name="time" required><br><br>

        <label for="memo">Memo:</label>
        <textarea id="memo" name="memo" rows="4" cols="50"></textarea><br><br>

        <input type="submit" value="Add Event">
    </form> -->

    <script>
        // 초기 설정
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth();
        let eventDetails = {};

        // 달력 생성 함수
        function createCalendar(year, month) {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = ''; // 달력 초기화

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

            // 달력의 헤더를 생성 (월과 연도)
            const header = document.createElement('div');
            header.classList.add('header');
            header.textContent = `${monthNames[month]} ${year}`;
            calendar.appendChild(header);

            // 날짜 표시 테이블 생성
            const table = document.createElement('table');
            table.classList.add('calendar-table');

            // 요일 표시
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const weekdayRow = document.createElement('tr');
            weekdays.forEach(weekday => {
                const dayCell = document.createElement('th');
                dayCell.textContent = weekday;
                weekdayRow.appendChild(dayCell);
            });
            table.appendChild(weekdayRow);

            // 해당 월의 첫 날과 마지막 날을 기준으로 날짜 생성
            const firstDayOfMonth = new Date(year, month, 1);
            const lastDayOfMonth = new Date(year, month + 1, 0);
            let currentDate = new Date(year, month, 1);
            const startDayOfWeek = firstDayOfMonth.getDay(); // 월의 첫 날의 요일 인덱스

            // 첫 주에 대한 새로운 행을 먼저 추가
            let newRow = document.createElement('tr');
            table.appendChild(newRow);

            // 첫 주의 시작이 일요일이 아닐 경우, 빈 셀로 채웁니다.
            for (let i = 0; i < startDayOfWeek; i++) {
                let emptyCell = document.createElement('td');
                newRow.appendChild(emptyCell);
            }

            // 현재 월의 날짜를 추가하면서 달력을 채웁니다.
            while (currentDate <= lastDayOfMonth) {
                if (currentDate.getDay() === 0) {
                    // 새로운 주를 시작할 때마다 새로운 행 추가
                    newRow = document.createElement('tr');
                    table.appendChild(newRow);
                }

                // 날짜 셀을 추가합니다.
                let dateCell = document.createElement('td');
                dateCell.textContent = currentDate.getDate();
                dateCell.dataset.date = currentDate.toISOString().split('T')[0]; // data-date 속성 추가
                // ... 날짜 셀에 이벤트 리스너와 기타 속성 추가 ...
                newRow.appendChild(dateCell);

                currentDate.setDate(currentDate.getDate() + 1);
            }

            calendar.appendChild(table);
        }

        // 날짜 클릭 시 이벤트 처리
        // 이벤트 위임을 사용하여 날짜 클릭 시 이벤트 처리
        document.getElementById('calendar').addEventListener('click', function (event) {
            // 이벤트가 발생한 요소에서 가장 가까운 'td' 요소를 찾습니다.
            const targetCell = event.target.closest('td');



            // 'td' 요소가 있고, 해당 요소에 data-date 속성이 있는 경우에만 처리합니다.
            if (targetCell && targetCell.dataset.date) {
                const clickedDate = targetCell.dataset.date;

                // 이전에 선택된 날짜의 'selected' 클래스 제거
                const previouslySelected = calendar.querySelector('.selected');
                if (previouslySelected) {
                    previouslySelected.classList.remove('selected');
                }

                // 클릭된 셀에 'selected' 클래스 추가
                targetCell.classList.add('selected');

                // 이벤트 정보를 가져오는 AJAX 요청을 보냅니다.
                fetch(`/get_event?selected_date=${clickedDate}`)
                    .then(response => response.json())
                    .then(data => {
                        // 이벤트 세부 정보를 표시합니다.
                        displayEventDetails(clickedDate, data);
                    })
                    .catch(error => {
                        console.error('Error fetching events:', error);
                    });
            }
        });

        // 이전 월 버튼 클릭 시
        document.getElementById('prev').addEventListener('click', function () {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            createCalendar(currentYear, currentMonth);
        });

        // 다음 월 버튼 클릭 시
        document.getElementById('next').addEventListener('click', function () {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            createCalendar(currentYear, currentMonth);
        });

        // 이벤트 세부 정보 표시 함수
        function displayEventDetails(date, events) {
            const eventDetailsContainer = document.getElementById('event-details');
            eventDetailsContainer.textContent = ''; // 이전 내용 초기화

            /// 선택한 날짜를 이벤트 창에 표시합니다.
            const selectedDateElement = document.createElement('p');
            selectedDateElement.id = 'selected-date';

            // 현재 날짜 문자열을 Date 객체로 변환
            const selectedDate = new Date(date);

            // 날짜를 1일 더하고 다시 문자열로 변환
            selectedDate.setDate(selectedDate.getDate() + 1);
            const formattedDate = selectedDate.toISOString().split('T')[0];

            selectedDateElement.textContent = 'Selected Date: ' + formattedDate;
            eventDetailsContainer.appendChild(selectedDateElement);

            if (events && events.length > 0) {
                events.forEach(event => {
                    const eventElement = document.createElement('div');
                    eventElement.classList.add('event-item');
                    let eventText = ''; // 이벤트 텍스트 초기화

                    if (event.time || event.time === 0) {
                        // time이 존재하면 시간 정보를 추가
                        eventText += `Time: ${event.time}`;
                    }

                    if (event.memo) {
                        // memo가 존재하면 메모 정보를 추가
                        if (eventText) {
                            // 이미 시간 정보가 있는 경우, 시간과 메모를 줄 바꿈으로 구분
                            eventText += '\n';
                        }
                        eventText += `Memo: ${event.memo}`;
                    }

                    // 이벤트 텍스트를 설정
                    eventElement.textContent = eventText;
                    eventDetailsContainer.appendChild(eventElement);
                });
            } else {
                const noEventsMessage = document.createElement('p');
                noEventsMessage.textContent = 'No events for this date.';
                eventDetailsContainer.appendChild(noEventsMessage);
            }
        }

        // 초기 달력 생성
        createCalendar(currentYear, currentMonth);



    </script>
</body>

</html>